version: "1.0"

# Global default settings (can be overridden per task)
defaults:
  model: sonnet  # Options: sonnet, opus, haiku (for prompt tasks)
  agent: claude  # Options: claude, codex (agent type to use for prompt tasks)
  execution_mode: sequential # Options: sequential, parallel
  branch_strategy: separate  # Options: separate (create new branches), main (work on main)
  auto_push: false  # Whether to push to remote after successful task completion
  abort_on_failure: true  # Abort all remaining tasks if one fails

tasks:
  - name: continue-or-quit-based-on-claude-usage
    type: command
    command: n4_cli check-claude-usage --threshold 90
    working_directory: .  # Optional: specify working directory
    timeout: 600  # Optional: timeout in seconds (default: 300)
    execution_step: 1  # Runs in parallel with Format code
    abort_on_failure: false
  - name: check-claude-usage
    prompt: |
      open https://claude.ai/settings/usage page, refresh page to get latest content and read what percentage is used for the current session, and when does it reset. save what you read by updating a yaml file called ./tmp/claude_usage.yaml with two keys: plan_usage_limit_session_pct and plan_usage_limit_reset_time.  plan_usage_limit_session_pct holds a numeric value, plan_usage_limit_reset_time holds a ISO timestamp in my machine's timezone. 
    prompt_flags: --chrome --permission-mode acceptEdits
    model: haiku
    execution_step: 2 
  - name: prepare_next_prompt
    type: prepare_next_prompt
    plan_file: ./tmp/plan.yaml
    prompt_file: ./tmp/prompt.md
    execution_step: 3
  - name: compute1
    type: prompt  # Optional, defaults to "prompt"
    prompt_file: ./tmp/prompt.md
    prompt_flags: --permission-mode acceptEdits --dangerously-skip-permissions
    model: sonnet
    execution_step: 4  # Runs in parallel with Format code
  - name: goto
    type: goto
    goto_step: 1 
    execution_step: 5 